需求描述：

USB权限控制，管控范围包括U盘、移动硬盘等多种移动存储设备，由系统安全组使用selinux提供统一接口，供后续安全中心、文管、域管等多个应用使用。



内部文档

## 1.问题点：多种文管共存，都有挂载行为怎么处理 ?

 * 系统自研文管（dde-file-manager），第三方文管（caja nautial 等使用）挂载会不会冲突。 ？？ 

##  2.开发关联方：selinux、文管，系统 udisk2 ，在挂载时候，进行打标签还是自己打？

* usb存储设备的标签谁来打？目前文管挂载时候打标签。
* 自己打标签会有啥问题？

##  3.那些格式无法打标签,有扩展属性，无扩展属性 打标签有啥区别？

* 所有支持扩展属性，需要自己打标签 btrfs、 encfs 、ext3、ext4、 ext4dev、f2fs、gfs、 gpfs、jffs2、jfs、lustre、overlay、squashfs、xfs、zfs等支持扩展属性的文件系统。

* *目前只对ext的打标签了。* 
* 其他无扩展属性的怎么打标签 ？ 
* usb设备，那些情况可能无法打标签，进行导致无法管控！

## 4. udisk2 挂载时候进行打标签，需要改造支持打不同标签。

* udisk2 的接口怎么改造

 rootcontext和defcontext可以同时设置

rootcontext设置磁盘根目录的标签  defcontext设置根目录下所有未打标签的文件的标签

context属性会无差别将所有文件的标签都设置为指定标签，包括已经打了标签的文件 这可能会成为潜在的绕过SELinux来攻击U盘的攻击方式  不安全



##  5.兼容解耦问题，依赖内核 、udisk2版本？

向前解耦实现？升级内核会影响其他的版本？ 升级udisk2 会影响其他的版本

现状：

* 计划时间update2 上线，系统旧版本比较多，涉及内核，变更影响比较大，建议目前计划不考虑兼容问题。或者只考虑1050公版？ 

* 域管这边有对应usb 管控需求，在安全中心的需求基础上增加了对特定进程的访问控制。 



## 6.对于加密设备有标签，在打标签，影响访问怎么处理？

要不要管控？加解密的操作的权限是要另外赋予的！

## 7.  拖拽到U盘的问题，需要进行管控

*   ·共享内存访问的管控问题

## 8.对外提供接口，设置、取消接口。进程例外怎么处理？

​          直接给进程打新的标签，会影响原来的权限，怎么处理更合适？


## 9 . 存储设备进行分区，怎么配置管理
* 不支持分区管控

## 10 . 基于selinux 策略,控制挂载权限 ，限制只能文管使用挂载?




附件：
相关指令：

* udisk udev 相关接口，获取USB 存储设备的信息

  每次挂载重新打标签，需要自己监控U盘的信息，记录U盘ID信息，进行区分，安全中心根据本地数据，进行下发打那种标签。

* 文管调用接口打标签
```
mount -b /dev/sda1 -o context=system_u:object_r：removeable_t:s0

udisksctl mount -b /dev/sda6 -o rootcontext="system_u:object_r:usbfs_t:s0",defcontext="system_u:object_r:removable_t:s0"

```
* 修复标签：
```
sudo fixfiles -F onboot
```

